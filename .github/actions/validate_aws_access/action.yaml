name: Validate AWS Access
description: Validate that the AWS credentials are present in the repository secrets and variables

inputs:
  aws_access_key_id:
    description: 'AWS Access Key ID'
    required: true
  aws_secret_access_key:
    description: 'AWS Secret Access Key'
    required: true

runs:
  using: "composite"
  steps:
    - name: Check AWS Access Key ID
      shell: bash
      run: |
        if [ -z "${{ inputs.aws_access_key_id }}" ]; then
          echo "::error::AWS Access Key ID is missing. Please add it to your repository secrets:"
          echo "1. Go to your repository settings"
          echo "2. Navigate to Secrets and Variables > Actions"
          echo "3. Click 'New repository secret'"
          echo "4. Name: AWS_ACCESS_KEY_ID"
          echo "5. Value: Your AWS Access Key ID"
          echo "6. Click 'Add secret'"
          echo ""
          echo "IMPORTANT: Make sure your IAM user has the required permissions for SES and SNS:"
          echo "1. Go to AWS IAM Console"
          echo "2. Find your IAM user"
          echo "3. Click 'Add permissions'"
          echo "4. Choose 'Attach existing policies directly'"
          echo "5. Search for and attach these policies:"
          echo "   - AmazonSESFullAccess"
          echo "   - AmazonSNSFullAccess"
          echo "6. Click 'Next' and 'Add permissions'"
          exit 1
        fi
        echo "✅ AWS Access Key ID is present"
    
    - name: Check AWS Secret Access Key
      shell: bash
      run: |
        if [ -z "${{ inputs.aws_secret_access_key }}" ]; then
          echo "::error::AWS Secret Access Key is missing. Please add it to your repository secrets:"
          echo "1. Go to your repository settings"
          echo "2. Navigate to Secrets and Variables > Actions"
          echo "3. Click 'New repository secret'"
          echo "4. Name: AWS_SECRET_ACCESS_KEY"
          echo "5. Value: Your AWS Secret Access Key"
          echo "6. Click 'Add secret'"
          echo ""
          echo "IMPORTANT: Make sure your IAM user has the required permissions for SES and SNS:"
          echo "1. Go to AWS IAM Console"
          echo "2. Find your IAM user"
          echo "3. Click 'Add permissions'"
          echo "4. Choose 'Attach existing policies directly'"
          echo "5. Search for and attach these policies:"
          echo "   - AmazonSESFullAccess"
          echo "   - AmazonSNSFullAccess"
          echo "6. Click 'Next' and 'Add permissions'"
          exit 1
        fi
        echo "✅ AWS Secret Access Key is present"

    