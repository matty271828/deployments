name: 'Setup Frontend'
description: 'Sets up the frontend repository for Cloudflare Pages deployment'

inputs:
  frontend_repo:
    description: 'Frontend Repository URL (e.g., https://github.com/username/repo)'
    required: true
  GH_PERSONAL_ACCESS_TOKEN:
    description: 'GitHub Personal Access Token'
    required: true
  CLOUDFLARE_API_TOKEN:
    description: 'Cloudflare API Token'
    required: true
  CLOUDFLARE_ACCOUNT_ID:
    description: 'Cloudflare Account ID'
    required: true

runs:
  using: "composite"
  steps:
    - name: Extract repository name
      id: extract_repo
      shell: bash
      run: |
        # Remove https://github.com/ from the URL
        REPO_PATH="${GITHUB_REPOSITORY#https://github.com/}"
        # Split into owner and repo
        OWNER="${REPO_PATH%%/*}"
        REPO="${REPO_PATH#*/}"
        echo "owner=$OWNER" >> $GITHUB_OUTPUT
        echo "repo_name=$REPO" >> $GITHUB_OUTPUT

    - name: Create Cloudflare Pages Project
      uses: cloudflare/pages-action@v1
      with:
        apiToken: ${{ inputs.CLOUDFLARE_API_TOKEN }}
        accountId: ${{ inputs.CLOUDFLARE_ACCOUNT_ID }}
        command: create
        projectName: ${{ steps.extract_repo.outputs.repo_name }}
        gitSourceType: github
        gitSourceOwner: ${{ steps.extract_repo.outputs.owner }}
        gitSourceRepo: ${{ steps.extract_repo.outputs.repo_name }}
        gitSourceBranch: main
        buildCommand: npm run build -- --mode production
        buildOutputDirectory: dist
        nodeVersion: 20